---
layout: post
title: 汇编语言笔记课程设计2
subtitle: 汇编语言笔记课程设计2
date: 2020-06-12
author: nightmare-man
tags: 8086汇编

---

# 汇编语言笔记课程设计2

### 0x00 任务一

![QQ截图20200612220449](/assets/img/QQ截图20200612220449.png)

![QQ截图20200612220456](/assets/img/QQ截图20200612220456.png)

​		思路 我们程序分为两部分 1 安装程序 2执行程序，执行程序负责实现上面功能，安装程序负责把执行程序放到盘符为a的软盘的mbr里（也就是0号扇区，chs就是0磁头0磁道1扇区），让后把bios启动顺序设置a盘位启动盘，这样我们的程序才会开机运行。

​		值得注意的是，开机后bios先执行，然后把我们的执行程序读入0:7c00处，执行程序要想再引导c盘的mbr进而引导操作系统，必须仍然把c盘的mbr放到0:7c00处才能正确执行（可能是mbr里的代码有硬编码，反正我试过放在内存其他地方执行后引导不了操作系统）。所以我们的执行程序要把自己挪到其他地方，比如0:7d00处，然后要引导操作系统的时候就把c盘mbr读到0:7c00，其余功能比较简单，下面给出我们的执行程序引导c盘操作系统的代码：

```assembly
assume cs:code
code segment
install:mov ax,cs
	mov ds,ax
	mov si,offset task-offset install+7c00h

	mov ax,cs
	mov es,ax
	mov di,7e00h

	mov cx,512
	cld
	rep movsb
	mov ax,0
	mov es,ax
	mov word ptr es:[200h],7e00h
	mov word ptr es:[202h],0
	jmp dword ptr es:[200h];以上部分负责把执行程序挪到7e00

task:   jmp short tts
str1:   db 'other os in c: will be loaded',0
tts:    mov ax,cs
        mov ds,ax
        mov si,offset str1-offset task+7c00h
        mov ax,0b800h
        mov es,ax
        mov di,2000
s:      mov al,ds:[si]
        cmp al,0
        je fin
        mov byte ptr es:[di],al
        mov byte ptr es:[di+1],2
        inc si
        add di,2
        jmp short s
fin:    mov ax,0
        mov es,ax
        mov bx,7c00h
        mov ah,2
        mov al,1
        mov ch,0
        mov cl,1
        mov dh,0
        mov dl,80h
        int 13h
        mov ax,0
        mov ds,ax
        mov si,200h
        mov word ptr ds:[si],7c00h
        mov word ptr ds:[si+2],0
        jmp dword ptr ds:[si];以上部分正真的引导程序
        
start:  mov ax,cs
        mov es,ax
        mov word ptr es:[1feh],0aa55h
        mov bx,0
        mov ah,3
        mov al,1
        mov ch,0
        mov cl,1
        mov dh,0
        mov dl,0
        int 13h
        mov ax,0
        mov es,ax
        mov bx,200h

        mov ah,2
        mov al,1
        mov ch,0
        mov cl,1
        mov dh,0
        mov dl,0
        int 13h

        mov ax,4c00h
        int 21h；安装程序
code ends
end start
```

![QQ截图20200612220254](/assets/img/QQ截图20200612220254.png)

​		上述代码成功运行，花了近一天半时间，终于把启动过程和bochs的使用搞清楚了，主要就是c盘mbr里的引导代码必须要在0:7c00处运行这一点坑

